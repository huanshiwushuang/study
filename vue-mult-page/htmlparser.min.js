(function(){function c(a,b){this._options=b?b:{};this._validateBuilder(a);this._builder=a;this.reset()}function f(a,b){this.reset();this._options=b?b:{};void 0===this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1);void 0===this._options.verbose&&(this._options.verbose=!0);void 0===this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0);void 0===this._options.caseSensitiveTags&&(this._options.caseSensitiveTags=!1);void 0===this._options.caseSensitiveAttr&&(this._options.caseSensitiveAttr=
    !1);"function"==typeof a&&(this._callback=a)}if(this.HTMLParser)return Error("HTMLParser exists");var m={},e={Text:"text",Tag:"tag",attrs:"attrs",CData:"cdata",Doctype:"doctype",Comment:"comment"};this.HTMLParser=m;c.prototype.reset=function(){this._state={mode:e.Text,pos:0,data:null,pendingText:null,pendingWrite:null,lastTag:null,isScript:!1,needData:!1,output:[],done:!1};this._builder.reset()};c.prototype.parseChunk=function(a){this._state.needData=!1;for(this._state.data=null!==this._state.data?
    this._state.data.substr(this.pos)+a:a;this._state.pos<this._state.data.length&&!this._state.needData;)this._parse(this._state)};c.prototype.parseComplete=function(a){this.reset();this.parseChunk(a);this.done()};c.prototype.done=function(){this._state.done=!0;this._parse(this._state);this._flushWrite();this._builder.done()};c.prototype._validateBuilder=function(a){if("object"!=typeof a)throw Error("Builder is not an object");if("function"!=typeof a.reset)throw Error("Builder method 'reset' is invalid");
    if("function"!=typeof a.done)throw Error("Builder method 'done' is invalid");if("function"!=typeof a.write)throw Error("Builder method 'write' is invalid");if("function"!=typeof a.error)throw Error("Builder method 'error' is invalid");};c.prototype._parse=function(){switch(this._state.mode){case e.Text:return this._parseText(this._state);case e.Tag:return this._parseTag(this._state);case e.attrs:return this._parseAttr(this._state);case e.CData:return this._parseCData(this._state);case e.Doctype:return this._parseDoctype(this._state);
    case e.Comment:return this._parseComment(this._state)}};c.prototype._writePending=function(a){this._state.pendingWrite||(this._state.pendingWrite=[]);this._state.pendingWrite.push(a)};c.prototype._flushWrite=function(){if(this._state.pendingWrite){for(var a=0,b=this._state.pendingWrite.length;a<b;a++)this._builder.write(this._state.pendingWrite[a]);this._state.pendingWrite=null}};c.prototype._write=function(a){this._flushWrite();this._builder.write(a)};c._re_parseText_scriptClose=/<\s*\/\s*script/ig;
    c.prototype._parseText=function(){var a=this._state;if(a.isScript){c._re_parseText_scriptClose.lastIndex=a.pos;var b=(b=c._re_parseText_scriptClose.exec(a.data))?b.index:-1}else b=a.data.indexOf("<",a.pos);-1===b?a.data.slice(a.pos,a.data.length):a.data.slice(a.pos,b);0>b&&a.done&&(b=a.data.length);if(0>b)a.isScript?a.needData=!0:(a.pendingText||(a.pendingText=[]),a.pendingText.push(a.data.slice(a.pos,a.data.length)),a.pos=a.data.length);else{if(a.pendingText){a.pendingText.push(a.data.slice(a.pos,
    b));var d=a.pendingText.join("");a.pendingText=null}else d=a.data.slice(a.pos,b);""!==d&&this._write({type:e.Text,data:d.replace(/^\s*([\s\S]*?)\s*$/,"$1")});a.pos=b+1;a.mode=e.Tag}};c.re_parseTag=/\s*(\/?)\s*([^\s>\/]+)(\s*)\??(>?)/g;c.prototype._parseTag=function(){var a=this._state;c.re_parseTag.lastIndex=a.pos;var b=c.re_parseTag.exec(a.data);if(b)if(b[1]||"!--"!==b[2].substr(0,3))if(b[1]||"![CDATA["!==b[2].substr(0,8))if(b[1]||"!DOCTYPE"!==b[2].substr(0,8))if(a.done||a.pos+b[0].length!==a.data.length){if(">"===
    b[4]){a.mode=e.Text;var d=b[0].substr(0,b[0].length-1)}else a.mode=e.attrs,d=b[0];a.pos+=b[0].length;b={type:e.Tag,name:b[1]+b[2],raw:d};a.mode===e.attrs&&(a.lastTag=b);"script"===b.name.toLowerCase()?a.isScript=!0:"/script"===b.name.toLowerCase()&&(a.isScript=!1);a.mode===e.attrs?this._writePending(b):this._write(b)}else a.needData=!0;else a.mode=e.Doctype,a.pos+=8;else a.mode=e.CData,a.pos+=8;else a.mode=e.Comment,a.pos+=3;else a.needData=!0};c.re_parseAttr_findName=/\s*([^=<>\s'"\/]+)\s*/g;c.prototype._parseAttr_findName=
    function(){c.re_parseAttr_findName.lastIndex=this._state.pos;var a=c.re_parseAttr_findName.exec(this._state.data);return a&&this._state.pos+a[0].length===c.re_parseAttr_findName.lastIndex?{match:a[0],name:a[1]}:null};c.re_parseAttr_findValue=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g;c.re_parseAttr_findValue_last=/\s*=\s*['"]?(.*)$/g;c.prototype._parseAttr_findValue=function(){var a=this._state;c.re_parseAttr_findValue.lastIndex=a.pos;var b=c.re_parseAttr_findValue.exec(a.data);if(!b){if(!a.done)return null;
    c.re_parseAttr_findValue_last.lastIndex=a.pos;return(b=c.re_parseAttr_findValue_last.exec(a.data))?{match:b[0],value:""!==b[1]?b[1]:null}:null}return a.pos+b[0].length!==c.re_parseAttr_findValue.lastIndex?null:{match:b[0],value:b[1]||b[2]||b[3]}};c.re_parseAttr_splitValue=/\s*=\s*['"]?/g;c.re_parseAttr_selfClose=/(\s*\/\s*)(>?)/g;c.prototype._parseAttr=function(){var a=this._state,b=this._parseAttr_findName(a);if(b&&"?"!==b.name){if(!a.done&&a.pos+b.match.length===a.data.length)return a.needData=
    !0,null;a.pos+=b.match.length;var d=this._parseAttr_findValue(a);if(d){if(!a.done&&a.pos+d.match.length===a.data.length){a.needData=!0;a.pos-=b.match.length;return}a.pos+=d.match.length}else{c.re_parseAttr_splitValue.lastIndex=a.pos;if(c.re_parseAttr_splitValue.exec(a.data)){a.needData=!0;a.pos-=b.match.length;return}d={match:"",value:null}}a.lastTag.raw+=b.match+d.match;this._writePending({type:e.attrs,name:b.name,data:d.value})}else{c.re_parseAttr_selfClose.lastIndex=a.pos;if((b=c.re_parseAttr_selfClose.exec(a.data))&&
    b.index===a.pos){if(!a.done&&!b[2]&&a.pos+b[0].length===a.data.length){a.needData=!0;return}a.lastTag.raw+=b[1];this._write({type:e.Tag,name:"/"+a.lastTag.name,raw:null});a.pos+=b[1].length}b=a.data.indexOf(">",a.pos);0>b?a.done?(a.lastTag.raw+=a.data.substr(a.pos),a.pos=a.data.length):a.needData=!0:(a.pos=b+1,a.mode=e.Text)}};c.re_parseCData_findEnding=/\]{1,2}$/;c.prototype._parseCData=function(){var a=this._state,b=a.data.indexOf("]]\x3e",a.pos);0>b&&a.done&&(b=a.data.length);if(0>b)c.re_parseCData_findEnding.lastIndex=
    a.pos,c.re_parseCData_findEnding.exec(a.data)||(a.pendingText||(a.pendingText=[]),a.pendingText.push(a.data.substr(a.pos,a.data.length)),a.pos=a.data.length),a.needData=!0;else{if(a.pendingText){a.pendingText.push(a.data.slice(a.pos,b));var d=a.pendingText.join("");a.pendingText=null}else d=a.data.slice(a.pos,b);this._write({type:e.CData,data:d});a.mode=e.Text;a.pos=b+3}};c.prototype._parseDoctype=function(){var a=this._state,b=a.data.indexOf(">",a.pos);0>b&&a.done&&(b=a.data.length);if(0>b)c.re_parseCData_findEnding.lastIndex=
    a.pos,a.pendingText||(a.pendingText=[]),a.pendingText.push(a.data.substr(a.pos,a.data.length)),a.pos=a.data.length,a.needData=!0;else{if(a.pendingText){a.pendingText.push(a.data.slice(a.pos,b));var d=a.pendingText.join("");a.pendingText=null}else d=a.data.slice(a.pos,b);this._write({type:e.Doctype,data:d});a.mode=e.Text;a.pos=b+1}};c.re_parseComment_findEnding=/\-{1,2}$/;c.prototype._parseComment=function(){var a=this._state,b=a.data.indexOf("--\x3e",a.pos);0>b&&a.done&&(b=a.data.length);if(0>b)c.re_parseComment_findEnding.lastIndex=
    a.pos,c.re_parseComment_findEnding.exec(a.data)||(a.pendingText||(a.pendingText=[]),a.pendingText.push(a.data.substr(a.pos,a.data.length)),a.pos=a.data.length),a.needData=!0;else{if(a.pendingText){a.pendingText.push(a.data.slice(a.pos,b));var d=a.pendingText.join("");a.pendingText=null}else d=a.data.slice(a.pos,b);this._write({type:e.Comment,data:d});a.mode=e.Text;a.pos=b+3}};f._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1,"?xml":1};
    f.reWhitespace=/^\s*$/;f.prototype.dom=null;f.prototype.reset=function(){this.dom=[];this._done=!1;this._tagStack=[];this._lastTag=null;this._tagStack.last=function(){return this.length?this[this.length-1]:null};this._col=this._row=1};f.prototype.done=function(){this._done=!0;this.handleCallback(null)};f.prototype.error=function(a){this.handleCallback(a)};f.prototype.handleCallback=function(a){if("function"!=typeof this._callback){if(a)throw a;}else this._callback(a,this.dom)};f.prototype.isEmptyTag=
    function(a){a=a.name.toLowerCase();if("?"==a.charAt(0))return!0;"/"==a.charAt(0)&&(a=a.slice(1));return this._options.enforceEmptyTags&&!!f._emptyTags[a]};f.prototype._copyNode=function(a){var b={type:a.type};this._options.verbose&&void 0!==a.raw&&(b.raw=a.raw);if(void 0!==a.name)switch(a.type){case e.Tag:b.name=this._options.caseSensitiveTags?a.name:a.name.toLowerCase();break;case e.attrs:b.name=this._options.caseSensitiveAttr?a.name:a.name.toLowerCase();break;default:b.name=this._options.caseSensitiveTags?
    a.name:a.name.toLowerCase()}void 0!==a.data&&(b.data=a.data);return b};f.prototype.write=function(a){this._done&&this.handleCallback(Error("Writing to the builder after done() called is not allowed without a reset()"));if(a.type!==e.Text||!this._options.ignoreWhitespace||!f.reWhitespace.test(a.data))if(this._tagStack.last())if(a.type===e.Tag)if("/"==a.name.charAt(0)){var b=this._options.caseSensitiveTags?a.name.slice(1):a.name.slice(1).toLowerCase();if(!this.isEmptyTag(a)){for(a=this._tagStack.length-
    1;-1<a&&this._tagStack[a--].name!=b;);if(-1<a||this._tagStack[0].name==b)for(;a<this._tagStack.length-1;)this._tagStack.pop()}}else b=this._tagStack.last(),a.type===e.attrs?(b.attrs||(b.attrs={}),b.attrs[this._options.caseSensitiveAttr?a.name:a.name.toLowerCase()]=a.data):(a=this._copyNode(a),b.children||(b.children=[]),b.children.push(a),this.isEmptyTag(a)||this._tagStack.push(a),a.type===e.Tag&&(this._lastTag=a));else b=this._tagStack.last(),a.type===e.attrs?(b.attrs||(b.attrs={}),b.attrs[this._options.caseSensitiveAttr?
    a.name:a.name.toLowerCase()]=a.data):(b.children||(b.children=[]),b.children.push(this._copyNode(a)));else a.type===e.Tag?"/"!=a.name.charAt(0)&&(a=this._copyNode(a),this.dom.push(a),this.isEmptyTag(a)||this._tagStack.push(a),this._lastTag=a):a.type===e.attrs&&this._lastTag?(this._lastTag.attrs||(this._lastTag.attrs={}),this._lastTag.attrs[this._options.caseSensitiveAttr?a.name:a.name.toLowerCase()]=a.data):this.dom.push(this._copyNode(a))};f.prototype._options=null;f.prototype._callback=null;f.prototype._done=
    !1;f.prototype._tagStack=null;var l={testNode:function(a,b){if(!b)return!1;for(var d in a)if(a.hasOwnProperty(d))if("tagName"==d){if(b.type!==e.Tag||!a.tagName(b.name))return!1}else if("tagType"==d){if(!a.tagType(b.type))return!1}else if("tagContains"==d){if(b.type!==e.Text&&b.type!==e.Comment&&b.type!==e.CData||!a.tagContains(b.data))return!1}else if(!b.attrs||!a[d](b.attrs[d]))return!1;return!0},by:function(a,b,d,g){function n(p){return function(q){return q==p}}d=void 0===d||null===d||!!d;g=isNaN(parseInt(g))?
    -1:parseInt(g);if(!b)return[];var h=[],k;for(k in a)"function"!=typeof a[k]&&(a[k]=n(a[k]));l.testNode(a,b)&&h.push(b);if(0<=g&&h.length>=g)return h;if(d&&b.children)b=b.children;else if(!(b instanceof Array))return h;for(k=0;k<b.length&&!(h=h.concat(l.by(a,b[k],d,g)),0<=g&&h.length>=g);k++);return h},byId:function(a,b,d){a=l.by({id:a},b,d,1);return a.length?a[0]:null},byTagName:function(a,b,d,g){return l.by({tagName:a},b,d,g)},byTagType:function(a,b,d,g){return l.by({tagType:a},b,d,g)}};m.Parser=
    c;m.Builder=f;m.NodeType=e;m.Util=l})();